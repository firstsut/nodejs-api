{
  "_args": [
    [
      {
        "raw": "fawn",
        "scope": null,
        "escapedName": "fawn",
        "name": "fawn",
        "rawSpec": "",
        "spec": "latest",
        "type": "tag"
      },
      "C:\\xampp\\htdocs\\restfull-node"
    ]
  ],
  "_from": "fawn@latest",
  "_id": "fawn@2.1.5",
  "_inCache": true,
  "_location": "/fawn",
  "_nodeVersion": "8.1.3",
  "_npmOperationalInternal": {
    "host": "s3://npm-registry-packages",
    "tmp": "tmp/fawn-2.1.5.tgz_1517428076266_0.055279889376834035"
  },
  "_npmUser": {
    "name": "oj",
    "email": "eolaojo@yahoo.com"
  },
  "_npmVersion": "5.6.0",
  "_phantomChildren": {
    "es6-promise": "3.2.1",
    "hooks-fixed": "2.0.0",
    "lodash": "4.17.11",
    "mpromise": "0.5.5",
    "ms": "2.0.0",
    "muri": "1.3.0",
    "readable-stream": "2.2.7",
    "regexp-clone": "0.0.1",
    "require_optional": "1.0.1",
    "sliced": "1.0.1"
  },
  "_requested": {
    "raw": "fawn",
    "scope": null,
    "escapedName": "fawn",
    "name": "fawn",
    "rawSpec": "",
    "spec": "latest",
    "type": "tag"
  },
  "_requiredBy": [
    "#USER",
    "/"
  ],
  "_resolved": "https://registry.npmjs.org/fawn/-/fawn-2.1.5.tgz",
  "_shasum": "2492b111b037db4e8372efbc68c72e3e50f0a5ef",
  "_shrinkwrap": null,
  "_spec": "fawn",
  "_where": "C:\\xampp\\htdocs\\restfull-node",
  "author": {
    "name": "Emmanuel Olaojo"
  },
  "bugs": {
    "url": "https://github.com/e-oj/Fawn/issues"
  },
  "dependencies": {
    "bluebird": "3.5.0",
    "gridfs-stream": "1.1.1",
    "mongoose": "4.12.3"
  },
  "description": "Promise based library for transactions in MongoDB",
  "devDependencies": {
    "chai": "4.1.0",
    "chai-as-promised": "7.1.1",
    "mocha": "3.4.2"
  },
  "directories": {},
  "dist": {
    "integrity": "sha512-aiRBvZ0P0UtzSmNF3pcodilg9U+ofeJwa6aJzq1jPgbZqsB2k9pYa5KnXSk8KH0Dgm/99WdMoZacmUaTt2xdvw==",
    "shasum": "2492b111b037db4e8372efbc68c72e3e50f0a5ef",
    "tarball": "https://registry.npmjs.org/fawn/-/fawn-2.1.5.tgz"
  },
  "gitHead": "a5edb8a6e149504f9569a3a8612c3828a47c53b1",
  "homepage": "https://github.com/e-oj/Fawn#readme",
  "keywords": [
    "mongoose",
    "mongoDB",
    "mongoose transaction",
    "mongoose transactions",
    "mongoose transact",
    "mongoose atomic",
    "atomic mongoose",
    "mongodb transaction",
    "mongodb transactions",
    "mongodb transact",
    "mongodb atomic",
    "atomic mongodb",
    "multi phase commit",
    "two phase commit",
    "transaction"
  ],
  "license": "MIT",
  "main": "index.js",
  "maintainers": [
    {
      "name": "oj",
      "email": "eolaojo@yahoo.com"
    }
  ],
  "name": "fawn",
  "optionalDependencies": {},
  "readme": "## [![Travis](https://img.shields.io/travis/e-oj/Fawn.svg?style=flat-square)](https://travis-ci.org/e-oj/Fawn) [![npm](https://img.shields.io/npm/l/fawn.svg?style=flat-square)](https://www.npmjs.com/package/fawn) [![npm](https://img.shields.io/npm/v/fawn.svg?style=flat-square)](https://www.npmjs.com/package/fawn) [![npm](https://img.shields.io/npm/dt/fawn.svg?style=flat-square)](https://www.npmjs.com/package/fawn)\n# Fawn\n## Promise based Library for transactions in MongoDB\n\nFawn provides the ability to carry out edits on a mongoDB database as a series of steps. If an error occurs on any of the steps, the database is returned to its initial state (its state before the transaction started). It's based on the two phase commit system described in the [MongoDB docs](https://docs.mongodb.com/manual/tutorial/perform-two-phase-commits/). Check out [this Medium article](https://codeburst.io/fawn-transactions-in-mongodb-988d8646e564) for a more detailed look.\n\n**View on <a href=\"https://github.com/e-oj/Fawn\" target=\"_blank\">GitHub</a>**\n\n- [Getting Started](#getting_started)\n- [Usage](#usage)\n- [API](#api)\n- [Misc.](#misc)\n- [Test](#test)\n\n## <a name=\"getting_started\"></a>Getting Started:\n\nInstall [node.js](https://nodejs.org) and [mongoDB](https://www.mongodb.com/download-center)\n\nStart mongoDB in a terminal: ```mongod```\n\nThen:\n```npm install fawn```\n\n## <a name=\"usage\"></a>Usage:\n\n```javascript\nvar Fawn = require(\"fawn\");\n\nFawn.init(\"mongodb://127.0.0.1:27017/testDB\");\n```\nor\n```javascript\nvar mongoose = require(\"mongoose\");\nmongoose.connect(\"mongodb://127.0.0.1:27017/testDB\");\n\nFawn.init(mongoose);\n```\n\n### <a name=\"examples\"></a>Examples\nSay you have two bank accounts, one belongs to John Smith and the other belongs to Broke Ass. You would like to transfer $20 from John Smith to Broke Ass. Assuming all first name and last name pairs are unique, this might look like:\n\n```javascript\nvar task = Fawn.Task();\n\n//assuming \"Accounts\" is the Accounts collection\ntask.update(\"Accounts\", {firstName: \"John\", lastName: \"Smith\"}, {$inc: {balance: -20}})\n  .update(\"Accounts\", {firstName: \"Broke\", lastName: \"Ass\"}, {$inc: {balance: 20}})\n  .run()\n  .then(function(results){\n    // task is complete \n\n    // result from first operation\n    var firstUpdateResult = results[0];\n\n    // result from second operation\n    var secondUpdateResult = results[1];\n  })\n  .catch(function(err){\n    // Everything has been rolled back.\n    \n    // log the error which caused the failure\n    console.log(err);\n  });\n```\n[GridFS]: <https://docs.mongodb.com/manual/core/gridfs/>\n\nFiles can be saved to and removed from [GridFS][]. Here's how you might update a user's profile image:\n```javascript\nvar newImageId = someMongoDbId;\n\ntask.saveFile(\"/path/to/new/profile/img\", {_id: newImageId, filename: \"profile.png\"})\n  .removeFile({_id: oldImageId})\n  .update(\"users\", {_id: userId}, {profileImageId: newImageId})\n  .run()\n  .then(function(results){\n    var newImgFile = results[0];\n    \n    console.log(newImgFile.filename) // profile.png\n  })\n  .catch(function(err){\n    // Everything has been rolled back.\n    \n    // log the error which caused the failure\n    console.log(err);\n  });\n```\n\nBy default, tasks run using the native driver but you can opt for mongoose. If you prefer not to chain function calls, you don't have to:\n\n```javascript\ntask.update(\"Accounts\", {firstName: \"Broke\", lastName: \"Ass\"}, {$inc: {balance: -20}})\ntask.update(\"Accounts\", {firstName: \"The\", lastName: \"Plug\"}, {$inc: {balance: 20}})\ntask.run({useMongoose: true})\n  .then(function(){\n    // update is complete\n  })\n  .catch(function(err){\n    // Everything has been rolled back.\n    \n    // log the error which caused the failure\n    console.log(err);\n  });\n```\n\nThe server could crash before a task is complete, You can use the Roller to rollback all incomplete transactions before starting your server:\n\n```javascript\n// assuming Fawn has been initialized. See Fawn.init below\nvar roller = Fawn.Roller();\n\nroller.roll()\n  .then(function(){\n    // start server\n  });\n```\n\n## <a name=\"api\"></a>API\n\n- [Fawn.init](#fawn_init)\n- [Fawn.Task](#fawn_task)\n- [task.initmodel](#task_initmodel)\n- [task.save](#task_save)\n- [task.update](#task_update)\n- [task.options](#task_options)\n- [task.remove](#task_remove)\n- [task.saveFile](#task_savefile)\n- [task.removeFile](#task_removefile)\n- [task.run](#task_run)\n- [Fawn.Roller](#fawn_roller)\n- [Roller.roll](#roller_roll)\n\n### <a name=\"fawn_init\"></a>Fawn.init(db, _collection, options): Initialize Fawn\n\n> db (required): [mongoose](https://github.com/Automattic/mongoose) instance or [connection string](https://docs.mongodb.com/manual/reference/connection-string/)\n\n> _collection (optional): Name of collection used internally by Fawn to store transactions\n\n> options (optional. lol): Connection options. Same as [mongoose connection options](http://mongoosejs.com/docs/connections.html#options)\n\n<br> **Note: if you're running multiple apps connected to the same db, provide a string value for _collection that's unique to each app. Do this to avoid a situation where one app rolls back the unfinished transaction(s) of another app.**\n\nIf you're using mongoose in your project initialize Fawn with mongoose:\n\n```javascript\nvar mongoose = require(\"mongoose\");\n\nmongoose.connect(\"mongodb://127.0.0.1:27017/testDB\");\n\n// remember, _collection is optional\nFawn.init(mongoose, \"Fawn_collection_name_if_you_want_to_specify\");\n```\n\nWithout mongoose, Initialize Fawn like so:\n\n```javascript\n// options object (http://mongoosejs.com/docs/connections.html#options)\nvar options = {\n  user: \"teh_huose_kat\",\n  pass: \"teh_Kitti_passwrod\"\n};\n\nvar collection = \"Fawn_collection_name_if_you_want_to_specify\";\n\n// remember, _collection and options are optional\nFawn.init(\"mongodb://127.0.0.1:27017/testDB\", collection || null, options || null);\n```\n<br>\n\n### <a name=\"fawn_task\"></a>Fawn.Task(): Create a Fawn task\n  \n  > returns: A new task\n\nAfter intitializing Fawn, create a task like so:\n\n```javascript\nvar task = Fawn.Task();\n```\n<br>\n\n### <a name=\"task_initmodel\"></a>task.initModel(modelName, schema): To initialize a model with a Schema.\n\n  > modelName (required): Name of the collection associated with this model\n  \n  > schema (optional): Same as object passed to [mongoose Schema](http://mongoosejs.com/docs/guide.html#definition). Also see [validation](http://mongoosejs.com/docs/validation.html)\n  \n  *Note: For model validation to work, run task with useMongoose set to true*\n  <br>\n<br>Initalizes a mongoose model with the provided schema. If you're using mongoose, define your models with mongoose wherever possible. If the model has been defined by mongoose before this function is called, mongoose will throw an OverwriteModelError and if it was defined by Fawn, Fawn will throw an Error. Models can be defined only once.\n  \n  ```javascript\n  var schema = {\n    name: {type: String, required: true}\n    , specials: [{title: String, year: Number}]\n  };\n  \n  task.initModel(\"comedians\", schema)\n    .save(\"comedians\", {name: \"Kevin Hart\", specials: [{title: \"What Now\", year: 2016}]})\n    .run({useMongoose: true})\n    .then(function(results){\n      console.log(results);\n    });\n  ```\n  \n  Save operations to the \"comedians\" model will validate against the schema;\n\n<br>\n\n### <a name=\"task_save\"></a>task.save(model, doc): To save a document</b>\n\n  > model (required): Name of the collection we're saving to or a mongoose model or a mongoose document\n\n  > doc (optional): Object to save or a mongoose document\n\t\n  <br>these are all valid:\n  \n  ```javascript\n  var Cars = mongoose.model(\"cars\", new Schema({make: String, year: Number}));\n  var toyota = new Cars({make: \"Toyota\", year: 2015});\n\n  task.save(\"cars\", {make: \"Toyota\", year: 2015});\n  task.save(Cars, {make: \"Toyota\", year: 2015});\n  task.save(\"cars\", toyota);\n  task.save(Cars, toyota);\n  task.save(toyota);\n  ```\n  \n  *Note: No changes will be made to to your database until you call task.run()*\n  \n<br> \n\n[mongoose]: <http://mongoosejs.com/docs/api.html#model_Model.update> \n\n[mongodb]: <https://docs.mongodb.com/manual/core/document/#document-query-filter>\n\n### <a name=\"task_update\"></a>task.update(model, condition, data): To update a document\n\n  > model (required): Name of the collection we're updating or a mongoose model or a mongoose document\n\n  > condition (required): Same as in [mongoose][] and [mongodb][]\n  \n  > data (optional): Data to update with same as in [mongoose][] and [mongodb](https://docs.mongodb.com/manual/reference/method/db.collection.update/#update-parameter)\n  \n  <br> These are all valid\n \n  ```javascript\n  var Cars = mongoose.model(\"cars\", new Schema({make: String, year: Number}));\n \n  task.update(\"cars\", {make: \"Toyota\"}, {year: 2016});\n  task.update(Cars, {make: \"Toyota\"}, {year: 2016});\n  \n  Cars.findOne({make: \"Toyota\"}, function(toyota){\n    task.update(toyota, {year: 2016});\n  });\n ```\n \n  *Note: No changes will be made to to your database until you call task.run()*\n  \n  <br>\n  \n### <a name=\"task_options\"></a>task.options(options): Add options to an update task.\n\n  > options (required): Update options = [mongoose][] options + {viaSave: Boolean}\n  \n  <br> Attach to update call as shown\n  \n  ```javascript\n  task.update(\"cars\", {make: \"Toyota\"}, {year: 2016})\n    .options({multi: true});\n  \n  // Also valid\n  \n  task.update(\"cars\", {make: \"Ford\"}, {year: 2016});\n  task.options({multi: true});\n  ```\n  \n  The <b>viaSave</b> option allows you update a <b><i>mongoose</i></b> document using the save function. It's useful if you want to trigger mongoose pre save hooks. <b><i>For this option to work you must run the task using mongoose</i></b>\n\nwith mongoose:\n```javascript\n  var doc = someMongooseDocument;\n  \n  doc.someProperty = newValue;\n  doc.save().then(console.log);\n```\n\nwith Fawn:\n```javascript\n  var doc = someMongooseDocument;\n  var newDoc = doc.toObject();\n  \n  newDoc.someProperty = newValue\n  \n  task.update(doc, newDoc)\n    .options({viaSave: true})\n    .run({useMongoose: true})\n    .then(console.log);\n  ```\n  *Note: No changes will be made to to your database until you call task.run()*\n\n  <br>\n  \n### <a name=\"task_remove\"></a>task.remove(model, condition): Remove document(s) from a collection\n\n  > model (required): Name of the collection we're deleting from or a mongoose model or a mongoose document\n  \n  > condition (optional): Same as in [mongoose](http://mongoosejs.com/docs/api.html#query_Query-remove)\n  \n  <br> These are all valid\n  \n  ```javascript\n  var Cars = mongoose.model(\"cars\", new Schema({make: String, year: Number}));\n  \n  // removes all cars with year === 2015\n  task.remove(\"cars\", {year: 2015});\n  task.remove(Cars, {year: 2015});\n  \n  Cars.findOne({year: 2015}, function(car){\n    // remove just this car\n    task.remove(car);\n  });\n  ```\n\n  *Note: No changes will be made to to your database until you call task.run()*\n\n  <br> \n  \n### <a name=\"task_savefile\"></a>task.saveFile(filePath, options): Save a file to the db via [GridFS][]\n\n  > filePath (required): Path to the file \n  \n  > options (optional): Same as [GridStore options][]\n  \n  [GridStore options]: <http://mongodb.github.io/node-mongodb-native/api-generated/gridstore.html#constructor>\n  \n  Saves the file at \"filePath\" to the database using GridFS. The result of this operation is the saved file's object. See [File object](https://docs.mongodb.com/manual/core/gridfs/#the-files-collection)\n  \n  ```javascript\n  task.saveFile(\"path/to/some/file\", {filename: \"a_string_filename.ext\"})\n    .update(\"SomeCollection\", updateConditions, updateData)\n    .run()\n    .then(function(results){\n      var file = results[0];\n      \n      console.log(file.filename); // a_string_filename.ext\n    }).catch(function(err){\n      // Everything has been rolled back.\n      \n      //log the error which caused the failure\n      console.log(err);\n    });\n  ```\n\n  *Note: No changes will be made to to your database until you call task.run()*\n\n  <br> \n\n### <a name=\"task_removefile\"></a>task.removeFile(options): Remove a file from the db via [GridFS][]\n\n  > options (required): Same as [GridStore options][]\n  \n  Removes a file that matches \"options\" from the database using GridFS. The result of this operation is a GridStore instance (can be ignored). See [GridStore]\n  \n  [GridStore]: <http://mongodb.github.io/node-mongodb-native/api-generated/gridstore.html>\n  \n  ```javascript\n  task.removeFile({_id: fileId})\n    .update(\"SomeCollection\", updateConditions, updateData)\n    .run()\n    .then(function(results){\n      // if you need the gridStore instance\n      var gridStore = results[0];\n    })\n    .catch(function(err){\n      // Everything has been rolled back.\n      \n      //log the error which caused the failure\n      console.log(err);\n    });\n  ```\n\n  *Note: No changes will be made to to your database until you call task.run()*\n\n  <br> \n  \n### <a name=\"task_run\"></a>task.run(options): Run a task.\n\n  > options: {useMongoose: Boolean}\n  \n  > returns: Promise\n\n  For the database changes to occur, you must call task.run(). This function returns a promise. On success, the promise is resolved with an array containing the [node-mongodb-native](http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html) or [mongoose](http://mongoosejs.com/docs/api.html) result of each operation in sequence. If an error occurs, the promise is rejected with the error that caused the failure.\n  \n  ```javascript\n  task.update(\"Accounts\", {firstName: \"John\", lastName: \"Smith\"}, {$inc: {balance: -20}})\n    .update(\"Accounts\", {firstName: \"Broke\", lastName: \"Ass\"}, {$inc: {balance: 20}})\n    .run() // or run({useMongoose: true}); \n    .then(function(results){\n      //task is complete \n\n      //result from first operation\n      var firstUpdateResult = results[0];\n\n      //result from second operation\n      var secondUpdateResult = results[1];\n    })\n    .catch(function(err){\n      // Everything has been rolled back.\n      \n      //log the error which caused the failure\n      console.log(err);\n    });\n  ```\n  <a name=\"task_run_results\"> Results Reference:\n  - the result of save is, [insertOneWriteOpResult](http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~insertOneWriteOpResult) for mongodb native, and the saved doc for mongoose\n  - the result of remove is, [deleteWriteOpResult](http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~deleteWriteOpResult) for mongodb native, and [writeOpResult](http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~WriteOpResult) for mongoose\n  - the result of update is, [updateWriteOpResult](http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~updateWriteOpResult) for mongodb native, and the [mongodb update output](https://docs.mongodb.com/v2.6/reference/command/update/#output) for mongoose\n  - the result of saveFile is the saved file object\n  - the result of removeFile is a [GridStore][] instance\n  <br>\n  \n### <a name=\"fawn_roller\"></a>Fawn.Roller(): Get the Roller object.\n  \n  > returns: The Roller object\n  \n  After initializing  Fawn, get the Roller like so:\n  \n  ```javascript\n  var Roller = Fawn.Roller();\n  ```\n <br>\n \n### <a name=\"roller_roll\"></a>Roller.roll(): Roll back all incomplete transcations\n  \n  In case of a server crash or any other fatal error, use the roller to return all the documents affected by incomplete transactions to their original state. Should only be used when no tasks are in progress, usually on server startup.\n  \n  ```javascript\n  var roller = Fawn.Roller();\n  \n  roller.roll()\n    .then(function(){\n      // start server\n    });\n  ```\n  <br>\n  \n## <a name=\"misc\"></a>Miscellaneous \n\n### Using the result of previous steps in subsequent steps\n  You might want to use the result of a previous step in a subsequent step. You can do this using a template object with the key \"$ojFuture\". Syntax: {$ojFuture: \"indexOfStep.resultProperty1.property2.-----.propertyN\"}. Here's how:\n  \n  ```javascript\n  task.save(\"Kids\", {name: {full: \"Brody Obi\"}}) //result will be {_id: someMongoId, name: {full: \"Brody Obi\"}}\n    .update(\"Parents\", {_id: parentId}, {firstChild: {id: {$ojFuture: \"0._id\"} , fullName: {$ojFuture: \"0.name.full\"}})\n    .run({useMongoose: true})\n    .then(function(){\n    \t// task is complete\n    })\n    .catch(function(err){\n      // Everything has been rolled back.\n    \n      //log the error which caused the failure\n      console.log(err);\n    });\n  ```\n  To use this feature you need to know the exact format of the step's result. For Reference: [Results](#task_run_results)\n  \n  \n## <a name=\"test\"></a>Test\n\n  To test this module, start mongodb in a terminal\n  \n  ```\n  mongod\n  ```\n  \n  Then cd to the project directory and run \n  \n  ```\n  npm test\n  ```\n",
  "readmeFilename": "README.md",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/e-oj/Fawn.git"
  },
  "scripts": {
    "test": "mocha tests/all.tests.js"
  },
  "version": "2.1.5"
}
